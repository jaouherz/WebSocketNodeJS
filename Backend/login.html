<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Utilisateur</title>
</head>
<body>

<h2>Login Utilisateur</h2>
<form id="userForm">
    <label for="id">ID :</label>
    <input type="text" id="id" name="id" required>
    <br><br>

    <label for="name">Nom :</label>
    <input type="text" id="name" name="name" required>
    <br><br>

    <button type="submit">Soumettre</button>
</form>

<h3>Utilisateur Login :</h3>
<div id="response"></div>

<script>
    document.getElementById("userForm").addEventListener("submit", async function(event) {
        event.preventDefault();

        const formData = new URLSearchParams(new FormData(this));

        try {
            const response = await fetch("/login", {
                method: "POST",
                body: formData,
                headers: {
                    "Content-Type": "application/x-www-form-urlencoded"
                }
            });

            const result = await response.json();

            if (response.ok && result.user) {
                document.getElementById("response").innerHTML =
                    `<p style="color: green;">ID: ${result.user.id} - Nom: ${result.user.name}</p>`;

                // Redirect to WebSocket connection page
                window.location.href = `/chat?id=${result.user.id}&name=${encodeURIComponent(result.user.name)}`;
            } else {
                document.getElementById("response").innerHTML =
                    `<p style="color: red;">Erreur : ${result.error || "Utilisateur non trouvé"}</p>`;
            }
        } catch (error) {
            document.getElementById("response").innerHTML =
                `<p style="color: red;">Erreur de connexion. Veuillez réessayer.</p>`;
        }
    });
</script>

</body>
</html>
